@model IntranetPOPS1819.ViewModel.CongesViewModel
@{
    ViewBag.Title = "Profil";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
</head>
<body>
    @Html.Partial("../Shared/Navbar")
    <div class="row">
        <div class="col-lg-2 table-bordered">
            <h3><font size="4">Récapitulatif Congés</font></h3>
            <br />

            <p>Déjà pris cette année : @Model._Collaborateur.GetNombreCongesPrisCetteAnnee()</p>
         

            <p>A prendre : @Model._Collaborateur.CongesRestants</p>


            <div class="listbox-area">
                <div class="left-area">
                    <span id="ss_elem">
                        Demandes en attente : @Model._Collaborateur.GetNombreCongesEnAttente()
                    </span>
                    <ul class=" table-bordered"
                        id="conges_enattente_list"
                        tabindex="0"
                        role="listbox"
                        aria-labelledby="conges_enattente">

                        @foreach (var c in Model._Collaborateur.Conges)
                        {
                            if (c.Statut == StatutConge.EnCours)
                            {
                                <li id="@c.Id" role="option">
                                    @c.Debut.ToString("dd/MM/yyyy") - @c.GetDuree() jours : @c.Statut
                                </li>
                            }
                        }



                    </ul>
                </div>
            </div>



            <br />

            @if (@Model._Collaborateur.GetNombreCongesValidesFuturs() != 0)
            {
                <div class="listbox-area">
                    <div class="left-area">
                        <span id="ss_elem">
                            Demandes validées : @Model._Collaborateur.GetNombreCongesValidesFuturs()
                        </span>
                        <ul class="table-bordered"
                            id="conges_valides_list"
                            tabindex="0"
                            role="listbox"
                            aria-labelledby="conges_valides">

                            @foreach (var c in Model._Collaborateur.Conges)
                            {
                                if (c.Statut == StatutConge.Valide)
                                {
                                    <li id="@c.Id" role="option">
                                        @c.Debut.ToString("dd/MM/yyyy") - @c.GetDuree() jours : @c.Statut
                                    </li>
                                }
                            }



                        </ul>
                    </div>
                </div>

            }
            else
            {
                <p>Aucune demande validée pour le moment <i class="em em-thinking_face"></i> </p>
            }

            <br />

            <button type="button" class="btn btn-secondary disabled">Supprimer cette demande</button>



        </div>
        <div class="col-lg-8 table-bordered text-center">
            <div class="demo-section k-content" style="text-align: center;">
                <h4>Faire une demande</h4>
                @(Html.Kendo().Calendar()
                                        .Name("calendar")
                                        .Selectable("multiple")
                                        .DisableDates(DayOfWeek.Saturday, DayOfWeek.Sunday)
                                        .Culture("fr-FR")
                                        .MonthTemplate(month => month.Content("# if ($.inArray(+data.date, enAttente) != -1) { #" +
                                        "<div class='" +
                                    "# if (data.value < 10) { #" +
                                        "refuse" +
                                    "# } else if ( data.value < 20 ) { #" +
                                        "enattente" +
                                    "# } else { #" +
                                        "valide" +
                                    "# } #" +
                                "'>#= data.value #</div>" +
                            "# } else { #" +
                            "#= data.value #" +
                            "# } #")
                    .WeekNumber("<a class='italic'>#= data.weekNumber #</a>"))
                )

                
            </div>
            <br />

            
            <button type="button" class="btn btn-primary">Je veux ce congé !</button>
            <br />
        @using (Html.BeginForm())
        {
            <div>
                @Html.LabelFor(Model => Model._Conge.Debut)
                @Html.EditorFor(Model => Model._Conge.Debut, new { @class = "form-control" })
                @Html.ValidationMessageFor(Model => Model._Conge.Debut)
            </div>
            <div>
                @Html.LabelFor(Model => Model._Conge.Fin)
                @Html.EditorFor(Model => Model._Conge.Fin, new { @class = "form-control" })
                @Html.ValidationMessageFor(Model => Model._Conge.Fin)
            </div>
            <div>
                @Html.LabelFor(Model => Model._Conge.Type)
                @Html.TextBoxFor(Model => Model._Conge.Type)
                @Html.ValidationMessageFor(Model => Model._Conge.Type)
            </div>
            <input type="submit" value="Demander congé" />
        }
            
        </div>
        <div class="col-lg-2 table-bordered">
            <h4>@DateTime.Today.ToString("dd/MM/yyyy")</h4>
            <h3><font size="4">Informations du service</font></h3>
            <br />

            <p>Nombre de demandes en attente dans le service : @Model._Collaborateur.Service.GetNombreCongesEnAttente()</p>
            <br />
            <p>Nombre de collaborateurs en congés dans le service : @Model._Collaborateur.Service.GetNombreCollaborateursEnConges() / @Model._Collaborateur.Service.Collaborateurs.Count (@(@Model._Collaborateur.Service.GetNombreCollaborateursEnConges() / @Model._Collaborateur.Service.Collaborateurs.Count)%)</p>



        </div>
</body>

<script>
    
    var today = new Date(), enAttente = [
        +new Date(today.getFullYear(), today.getMonth(), 8),
        +new Date(today.getFullYear(), today.getMonth(), 12),
        +new Date(today.getFullYear(), today.getMonth(), 24),
        +new Date(today.getFullYear(), today.getMonth() + 1, 6),
        +new Date(today.getFullYear(), today.getMonth() + 1, 7),
        +new Date(today.getFullYear(), today.getMonth() + 1, 25),
        +new Date(today.getFullYear(), today.getMonth() + 1, 27),
        +new Date(today.getFullYear(), today.getMonth() - 1, 3),
        +new Date(today.getFullYear(), today.getMonth() - 1, 5),
        +new Date(today.getFullYear(), today.getMonth() - 2, 22),
        +new Date(today.getFullYear(), today.getMonth() - 2, 27)
    ];

    @*var enAttente = @Html.Raw(Json.Encode(Model._Collaborateur.GetTousJoursCongesEnAttente()));*@

    

</script>

<style>

#calendar,
#calendar .k-calendar-view,
#calendar .k-content {
        width: 100%;
                }

    /* Template Days */

    .refuse {
        font-weight: bold;
        color: #C12600;
    }
    .enattente {
        font-weight: bold;
        color: #f9d71c;
    }
    .valide {
        font-weight: bold;
        color: #4cff00;
    }

   
</style>

</html>
